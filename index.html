<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tablero Pro - Raiz Cuadrada</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">

    <style>
        /* ESTILOS ORIGINALES √çNTEGROS */
        :root {
            --bg-canvas: #FFFFFF; --ui-white: #FFFFFF; --ui-gray-light: #F2F2F2;
            --ui-gray-med: #CCCCCC; --ui-gray-dark: #888888; --text-main: #222222; --accent: #4A90E2;
        }

        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; font-family: 'Inter', sans-serif; background: var(--ui-gray-light); }

        header { position: absolute; top: 15px; left: 20px; z-index: 100; display: flex; align-items: baseline; gap: 10px; pointer-events: none; }
        header h1 { font-family: 'Playfair Display', serif; font-size: 28px; margin: 0; color: var(--text-main); }
        header span { font-family: 'Playfair Display', serif; font-size: 16px; color: var(--ui-gray-dark); font-weight: bold; }

        /* LIBRER√çA DE S√çMBOLOS */
        .symbol-library { position: absolute; bottom: 90px; right: 20px; width: 300px; background: var(--ui-white); border-radius: 12px; padding: 12px; border: 1px solid var(--ui-gray-med); box-shadow: 0 4px 15px rgba(0,0,0,0.1); z-index: 1000; }
        .pill-container { display: flex; gap: 6px; overflow-x: auto; padding-bottom: 8px; border-bottom: 1px solid var(--ui-gray-light); }
        .symbol-grid { display: flex; gap: 8px; overflow-x: auto; padding: 10px 0; }
        .pill { padding: 5px 12px; background: var(--ui-gray-light); border-radius: 15px; font-size: 11px; font-weight: 600; cursor: pointer; border: none; color: var(--ui-gray-dark); white-space: nowrap; }
        .pill.active { background: var(--text-main); color: var(--ui-white); }
        .symbol-btn { background: white; border: 1px solid var(--ui-gray-med); border-radius: 8px; min-width: 50px; height: 50px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }

        /* EDITOR LATEX */
        #editor-panel { position: absolute; bottom: 90px; left: 50%; transform: translateX(-50%); background: white; padding: 15px; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.15); border: 1px solid var(--ui-gray-med); display: none; z-index: 2000; flex-direction: column; gap: 10px; width: 300px; }
        #editor-panel input { padding: 10px; border: 1px solid var(--ui-gray-med); border-radius: 8px; font-family: monospace; }
        .editor-btns { display: flex; gap: 8px; }
        .editor-btns button { flex: 1; padding: 8px; border-radius: 6px; border: none; cursor: pointer; font-weight: 600; }

        /* CONTENEDOR Y CAPAS (FIX APLICADO) */
        #board-container { width: 100vw; height: 100vh; position: relative; background: var(--bg-canvas); overflow: hidden; }
        
        /* El SVG ahora no bloquea los elementos de abajo por defecto */
        #svg-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 5; pointer-events: none; }
        #latex-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none; }

        /* Activar interacci√≥n del SVG solo cuando dibujamos o seleccionamos trazos */
        .draw-mode #svg-canvas, .select-mode #svg-canvas { pointer-events: auto; }

        .draggable-item { position: absolute; cursor: move; padding: 10px; transform-origin: top left; pointer-events: auto; border: 1px dashed transparent; transition: border 0.2s; }
        .draggable-item.selected { border: 1px dashed var(--accent) !important; background: rgba(74, 144, 226, 0.05); }
        
        /* Asegurar que el LaTeX est√© por encima de la imagen dentro del mismo contenedor si se desea */
        .latex-item { z-index: 10; }
        .image-item { z-index: 5; }

        .draggable-item img { width: 100%; height: 100%; display: block; user-select: none; -webkit-user-drag: none; }
        .resize-handle { position: absolute; bottom: 0; right: 0; width: 12px; height: 12px; background: var(--accent); cursor: nwse-resize; display: none; z-index: 100; }
        .draggable-item.selected .resize-handle { display: block; }

        .sketch-path { fill: none; stroke-linecap: round; stroke-linejoin: round; cursor: move; pointer-events: auto; }
        .sketch-path.selected { stroke: var(--accent) !important; filter: drop-shadow(0 0 3px rgba(74, 144, 226, 0.5)); }
        .selection-box { fill: rgba(74, 144, 226, 0.1); stroke: var(--accent); stroke-width: 1; stroke-dasharray: 4; pointer-events: none; }

        /* TOOLBARS */
        .toolbar { position: absolute; bottom: 20px; left: 50%; background: var(--ui-white); padding: 8px 15px; border-radius: 50px; display: flex; gap: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 1px solid var(--ui-gray-med); z-index: 1000; }
        .tool-btn { border: 1px solid transparent; background: none; font-size: 13px; cursor: pointer; padding: 8px 12px; border-radius: 10px; color: var(--ui-gray-dark); font-weight: 600; transition: all 0.2s; }
        .tool-btn.active { background: var(--ui-gray-light); color: var(--text-main); border-color: var(--ui-gray-med); }
        .divider { width: 1px; background: var(--ui-gray-med); margin: 0 5px; }

        .style-bar { position: absolute; top: 80px; left: 20px; background: var(--ui-white); padding: 12px; border-radius: 12px; display: flex; flex-direction: column; gap: 12px; border: 1px solid var(--ui-gray-med); box-shadow: 0 4px 15px rgba(0,0,0,0.1); z-index: 1000; }
        .color-picker { width: 35px; height: 35px; border: 2px solid var(--ui-gray-light); border-radius: 50%; cursor: pointer; }
        
        #board-container.grid-active { 
            background-image: radial-gradient(rgba(0,0,0,0.1) 1px, transparent 1px); 
            background-size: 20px 20px; 
        }
    </style>
</head>
<body>

<header>
    <h1>Tablero</h1>
    <span>‚àö(Raiz) Cuadrada¬≤</span>
</header>

<div id="editor-panel">
    <strong id="editor-title">EDITAR LATEX</strong>
    <input type="text" id="latex-input" placeholder="Escribe comando LaTeX...">
    <div class="editor-btns">
        <button onclick="confirmEdit()" style="background: var(--text-main); color: white;">Aplicar</button>
        <button onclick="closeEditor()" style="background: var(--ui-gray-light);">Cancelar</button>
    </div>
</div>

<div class="symbol-library">
    <div class="pill-container" id="category-pills"></div>
    <div class="symbol-grid" id="symbol-display"></div>
</div>

<div class="style-bar">
    <span style="font-size: 10px; font-weight: bold;">COLOR</span>
    <input type="color" id="stroke-color" class="color-picker" value="#222222">
    <span style="font-size: 10px; font-weight: bold;">GROSOR</span>
    <input type="range" id="stroke-width" min="1" max="20" value="3">
</div>

<div class="toolbar">
    <button class="tool-btn" onclick="undo()">‚Ü∂</button>
    <button class="tool-btn" onclick="redo()">‚Ü∑</button>
    <div class="divider"></div>
    <button class="tool-btn active" id="btn-draw" onclick="setMode('DRAW', this)">üñâ L√°piz</button>
    <button class="tool-btn" onclick="setMode('POLY', this)">ñ°¨ Polil√≠nea</button>
    <button class="tool-btn" onclick="setMode('ERASE', this)">‚úÑ Borrar</button>
    <button class="tool-btn" id="btn-select" onclick="setMode('SELECT', this)">‚¨ö Selecci√≥n</button>
    <div class="divider"></div>
    <button class="tool-btn" onclick="openEditorForNew()">‚àë LaTeX</button>
    <button class="tool-btn" onclick="setMode('RECT', this)">‚ñ¢</button>
    <button class="tool-btn" onclick="setMode('CIRCLE', this)">‚óØ</button>
    <div class="divider"></div>
    <button class="tool-btn" onclick="document.getElementById('image-input').click()">üóé Foto</button>
    <button class="tool-btn" onclick="toggleGrid()">‚åó Grilla</button>
    <button class="tool-btn" onclick="exportPNG()" style="color: var(--accent)">Exportar</button>
    <input type="file" id="image-input" style="display:none" accept="image/*" onchange="handleImageUpload(event)">
</div>

<div id="board-container">
    <svg id="svg-canvas"></svg>
    <div id="latex-layer"></div>
</div>

<script>
    /* L√ìGICA DE ESTADO √çNTEGRA */
    let mode = 'DRAW', isDrawing = false, startX, startY, isDraggingItem = false;
    let currentPath = null, polyPoints = [], selectedElements = [], selectionRect = null;
    let undoStack = [], redoStack = [], editingItem = null, clipboard = [];
    
    const svg = document.getElementById('svg-canvas');
    const latexLayer = document.getElementById('latex-layer');
    const editorPanel = document.getElementById('editor-panel');
    const latexInput = document.getElementById('latex-input');
    
    let snapEnabled = false; const gridStep = 20;
    let currentStrokeColor = '#222222'; let currentStrokeWidth = 3;
    let isPanning = false; let viewBox = { x: 0, y: 0, w: window.innerWidth, h: window.innerHeight };

    document.getElementById('stroke-color').onchange = (e) => currentStrokeColor = e.target.value;
    document.getElementById('stroke-width').oninput = (e) => currentStrokeWidth = e.target.value;

    const library = {
        "Griegas": ["\\alpha", "\\beta", "\\gamma", "\\theta", "\\pi", "\\omega", "\\Delta"],
        "C√°lculo": ["\\int_{a}^{b}", "\\sum_{i=1}^{n}", "\\lim_{x \\to \\infty}", "\\frac{df}{dx}", "\\iint"],
        "√Ålgebra": ["\\sqrt{x}", "x^2", "\\frac{a}{b}", "\\pm", "\\neq", "\\infty", "\\approx"],
        "Matrices": ["\\begin{pmatrix} a & b \\\\ c & d \\end{pmatrix}", "\\det(A)", "I_n"]
    };

    function initLibrary() {
        const container = document.getElementById('category-pills');
        Object.keys(library).forEach((cat, i) => {
            const btn = document.createElement('button');
            btn.className = `pill ${i === 0 ? 'active' : ''}`;
            btn.innerText = cat;
            btn.onclick = () => {
                document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
                btn.classList.add('active'); renderSymbols(cat);
            };
            container.appendChild(btn);
        });
        renderSymbols(Object.keys(library)[0]);
        saveState();
    }

    function renderSymbols(cat) {
        const grid = document.getElementById('symbol-display');
        grid.innerHTML = '';
        library[cat].forEach(s => {
            const b = document.createElement('div');
            b.className = 'symbol-btn';
            katex.render(s, b);
            b.onclick = () => addLatexItem(s);
            grid.appendChild(b);
        });
    }

    function setMode(m, btn) {
        mode = m;
        document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const board = document.getElementById('board-container');
        board.classList.remove('draw-mode', 'select-mode');
        
        if (['DRAW', 'POLY', 'RECT', 'CIRCLE'].includes(m)) {
            board.classList.add('draw-mode'); deselectAll();
        } else if (m === 'SELECT') {
            board.classList.add('select-mode');
        }
    }

    /* MOUSE EVENTS CON PANNING Y DIBUJO COMPLETO */
    svg.onmousedown = (e) => {
        if (isPanning) return;
        const x = snap(e.offsetX + viewBox.x), y = snap(e.offsetY + viewBox.y);
        startX = x; startY = y;

        if (mode === 'SELECT') {
            if (isDraggingItem) return;
            deselectAll(); isDrawing = true;
            selectionRect = createSVGElement('rect', { class: 'selection-box', x, y, width: 0, height: 0 });
            svg.appendChild(selectionRect);
        } else {
            isDrawing = true;
            if (mode === 'POLY') {
                if (polyPoints.length === 0) {
                    currentPath = createSVGElement('polyline', { class: 'sketch-path', points: `${x},${y}`, style: `stroke:${currentStrokeColor};stroke-width:${currentStrokeWidth}` });
                    svg.appendChild(currentPath);
                }
                polyPoints.push(`${x},${y}`);
            } else {
                if (mode === 'DRAW') currentPath = createSVGElement('path', { d: `M ${x} ${y}`, class: 'sketch-path', style: `stroke:${currentStrokeColor};stroke-width:${currentStrokeWidth}` });
                else if (mode === 'RECT') currentPath = createSVGElement('rect', { x, y, width: 0, height: 0, class: 'sketch-path', style: `stroke:${currentStrokeColor};stroke-width:${currentStrokeWidth}` });
                else if (mode === 'CIRCLE') currentPath = createSVGElement('circle', { cx: x, cy: y, r: 0, class: 'sketch-path', style: `stroke:${currentStrokeColor};stroke-width:${currentStrokeWidth}` });
                svg.appendChild(currentPath);
            }
        }
    };

    svg.onmousemove = (e) => {
        if (isPanning && e.buttons === 1) {
            viewBox.x -= e.movementX; viewBox.y -= e.movementY;
            updateViewBox(); return;
        }
        if (!isDrawing) return;
        const x = snap(e.offsetX + viewBox.x), y = snap(e.offsetY + viewBox.y);

        if (selectionRect) {
            let w = x - startX, h = y - startY;
            selectionRect.setAttribute('x', w < 0 ? x : startX); selectionRect.setAttribute('y', h < 0 ? y : startY);
            selectionRect.setAttribute('width', Math.abs(w)); selectionRect.setAttribute('height', Math.abs(h));
        } else if (currentPath) {
            if (mode === 'DRAW') currentPath.setAttribute('d', currentPath.getAttribute('d') + ` L ${x} ${y}`);
            else if (mode === 'RECT') {
                let w = x - startX, h = y - startY;
                currentPath.setAttribute('x', w < 0 ? x : startX); currentPath.setAttribute('y', h < 0 ? y : startY);
                currentPath.setAttribute('width', Math.abs(w)); currentPath.setAttribute('height', Math.abs(h));
            } else if (mode === 'CIRCLE') {
                currentPath.setAttribute('r', Math.sqrt((x-startX)**2 + (y-startY)**2));
            } else if (mode === 'POLY') {
                currentPath.setAttribute('points', [...polyPoints, `${x},${y}`].join(' '));
            }
        }
    };

    window.onmouseup = () => {
        if (selectionRect) {
            const r = selectionRect.getBoundingClientRect();
            document.querySelectorAll('.sketch-path, .draggable-item').forEach(el => {
                const elR = el.getBoundingClientRect();
                if (!(elR.left > r.right || elR.right < r.left || elR.top > r.bottom || elR.bottom < r.top)) {
                    el.classList.add('selected'); selectedElements.push(el);
                }
            });
            selectionRect.remove(); selectionRect = null;
        }
        if (isDrawing && mode !== 'POLY') {
            if (currentPath) makeMovable(currentPath, 'path');
            saveState();
        }
        isDrawing = false;
    };

    function updateViewBox() {
        svg.setAttribute('viewBox', `${viewBox.x} ${viewBox.y} ${viewBox.w} ${viewBox.h}`);
        latexLayer.style.transform = `translate(${-viewBox.x}px, ${-viewBox.y}px)`;
    }

    /* TECLADO: ESPACIO, CTRL+C/V, DEL, UNDO */
    window.onkeydown = (e) => {
        if (document.activeElement.tagName === 'INPUT') return;
        if (e.code === 'Space') { isPanning = true; document.body.style.cursor = 'grab'; e.preventDefault(); }
        if (e.key === 'Backspace' || e.key === 'Delete') { selectedElements.forEach(el => el.remove()); saveState(); }
        if (e.ctrlKey && e.key === 'c') {
            clipboard = selectedElements.map(el => {
                let clone = el.cloneNode(true);
                clone.classList.remove('selected');
                return clone;
            });
        }
        if (e.ctrlKey && e.key === 'v') {
            clipboard.forEach(clone => {
                let newEl = clone.cloneNode(true);
                if (newEl.tagName.toLowerCase() === 'div') {
                    newEl.style.left = (parseFloat(newEl.style.left) + 20) + "px";
                    newEl.style.top = (parseFloat(newEl.style.top) + 20) + "px";
                    latexLayer.appendChild(newEl);
                    makeMovable(newEl, 'div');
                    makeManualResize(newEl, newEl.querySelector('.resize-handle'));
                    // Restaurar evento doble clic para LaTeX
                    if(newEl.dataset.tex) {
                        newEl.ondblclick = (ev) => { ev.stopPropagation(); editingItem = newEl; latexInput.value = newEl.dataset.tex; editorPanel.style.display = 'flex'; latexInput.focus(); };
                    }
                } else {
                    svg.appendChild(newEl); makeMovable(newEl, 'path');
                }
            });
            saveState();
        }
        if (e.ctrlKey && e.key === 'z') { e.preventDefault(); undo(); }
        if (e.ctrlKey && e.key === 'y') { e.preventDefault(); redo(); }
    };

    window.onkeyup = (e) => { if (e.code === 'Space') { isPanning = false; document.body.style.cursor = 'default'; } };

    /* L√ìGICA DE ELEMENTOS DRAGGABLES */
    function addLatexItem(tex) {
        const div = document.createElement('div');
        div.className = 'draggable-item latex-item';
        div.dataset.tex = tex;
        div.style.left = (viewBox.x + 100) + 'px'; div.style.top = (viewBox.y + 100) + 'px';
        div.innerHTML = `<div class="content"></div><div class="resize-handle"></div>`;
        latexLayer.appendChild(div);
        katex.render(tex, div.querySelector('.content'));
        
        div.ondblclick = (e) => {
            e.stopPropagation(); editingItem = div;
            latexInput.value = div.dataset.tex;
            editorPanel.style.display = 'flex';
            latexInput.focus();
        };

        makeMovable(div, 'div');
        makeManualResize(div, div.querySelector('.resize-handle'));
        saveState();
    }

    function handleImageUpload(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
            const div = document.createElement('div');
            div.className = 'draggable-item image-item';
            div.style.left = (viewBox.x + 50) + 'px'; div.style.top = (viewBox.y + 50) + 'px';
            div.style.width = '200px';
            div.innerHTML = `<img src="${event.target.result}"><div class="resize-handle"></div>`;
            latexLayer.appendChild(div);
            makeMovable(div, 'div');
            makeManualResize(div, div.querySelector('.resize-handle'));
            saveState();
        };
        reader.readAsDataURL(file);
    }

    function makeMovable(el, type) {
        let isMoving = false, lastX, lastY;
        
        el.onmousedown = (e) => {
            if (mode === 'ERASE') { el.remove(); saveState(); return; }
            if (mode !== 'SELECT') return;
            e.stopPropagation();
            if (!el.classList.contains('selected')) { deselectAll(); el.classList.add('selected'); selectedElements = [el]; }
            isMoving = true; isDraggingItem = true;
            lastX = e.clientX; lastY = e.clientY;
        };

        window.addEventListener('mousemove', (e) => {
            if (!isMoving) return;
            const dx = e.clientX - lastX, dy = e.clientY - lastY;
            selectedElements.forEach(item => {
                if (item.tagName.toLowerCase() === 'div') {
                    item.style.left = (parseFloat(item.style.left) + dx) + 'px';
                    item.style.top = (parseFloat(item.style.top) + dy) + 'px';
                } else {
                    const t = item.getAttribute('transform') || 'translate(0,0)';
                    const parts = t.match(/translate\(([^,)]+),?\s*([^)]+)?\)/);
                    let tx = parts ? parseFloat(parts[1]) : 0, ty = parts ? parseFloat(parts[2]) : 0;
                    item.setAttribute('transform', `translate(${tx + dx},${ty + dy})`);
                }
            });
            lastX = e.clientX; lastY = e.clientY;
        });

        window.addEventListener('mouseup', () => { if(isMoving) saveState(); isMoving = false; isDraggingItem = false; });
    }

    function makeManualResize(el, handle) {
        handle.onmousedown = (e) => {
            e.stopPropagation();
            let startW = el.offsetWidth, startH = el.offsetHeight, startX = e.clientX, startY = e.clientY;
            let isLatex = el.classList.contains('latex-item');
            let initialFontSize = isLatex ? parseFloat(window.getComputedStyle(el.querySelector('.content')).fontSize) : 0;

            const onMouseMove = (ev) => {
                let nw = startW + (ev.clientX - startX), nh = startH + (ev.clientY - startY);
                el.style.width = nw + 'px';
                if (!isLatex) el.style.height = nh + 'px';
                else {
                    // Escalar fuente si es LaTeX
                    let scale = nw / startW;
                    el.querySelector('.content').style.fontSize = (initialFontSize * scale) + 'px';
                }
            };
            const onMouseUp = () => { window.removeEventListener('mousemove', onMouseMove); saveState(); };
            window.addEventListener('mousemove', onMouseMove);
            window.addEventListener('mouseup', onMouseUp);
        };
    }

    /* SISTEMA DE HISTORIAL Y UI */
    function saveState() {
        undoStack.push({ svg: svg.innerHTML, latex: latexLayer.innerHTML });
        if (undoStack.length > 30) undoStack.shift();
        redoStack = [];
    }

    function undo() {
        if (undoStack.length <= 1) return;
        redoStack.push(undoStack.pop());
        applyState(undoStack[undoStack.length - 1]);
    }

    function redo() {
        if (redoStack.length === 0) return;
        const state = redoStack.pop();
        undoStack.push(state);
        applyState(state);
    }

    function applyState(state) {
        svg.innerHTML = state.svg; latexLayer.innerHTML = state.latex;
        // Re-vincular eventos
        document.querySelectorAll('.sketch-path').forEach(p => makeMovable(p, 'path'));
        document.querySelectorAll('.draggable-item').forEach(d => {
            makeMovable(d, 'div'); makeManualResize(d, d.querySelector('.resize-handle'));
            if (d.dataset.tex) {
                d.ondblclick = (e) => { e.stopPropagation(); editingItem = d; latexInput.value = d.dataset.tex; editorPanel.style.display = 'flex'; latexInput.focus(); };
            }
        });
    }

    function deselectAll() { document.querySelectorAll('.selected').forEach(el => el.classList.remove('selected')); selectedElements = []; }
    function createSVGElement(tag, attrs) {
        const el = document.createElementNS("http://www.w3.org/2000/svg", tag);
        for (let k in attrs) el.setAttribute(k, attrs[k]);
        return el;
    }
    function snap(v) { return snapEnabled ? Math.round(v/gridStep)*gridStep : v; }
    function toggleGrid() { snapEnabled = !snapEnabled; document.getElementById('board-container').classList.toggle('grid-active'); }
    function closeEditor() { editorPanel.style.display = 'none'; editingItem = null; }
    function openEditorForNew() { editingItem = null; latexInput.value = ''; editorPanel.style.display = 'flex'; latexInput.focus(); }
    function confirmEdit() {
        const val = latexInput.value; if (!val) return;
        if (editingItem) {
            editingItem.dataset.tex = val; katex.render(val, editingItem.querySelector('.content'));
        } else { addLatexItem(val); }
        closeEditor(); saveState();
    }

    async function exportPNG() {
        deselectAll();
        const canvas = await html2canvas(document.getElementById('board-container'));
        const link = document.createElement('a');
        link.download = 'tablero-raiz.png'; link.href = canvas.toDataURL(); link.click();
    }

    function makePanelDraggable(el) {
        let p1=0, p2=0, p3=0, p4=0;
        el.onmousedown = (e) => {
            if (['BUTTON','INPUT','SELECT'].includes(e.target.tagName) || e.target.classList.contains('pill')) return;
            p3 = e.clientX; p4 = e.clientY;
            document.onmousemove = (ev) => {
                p1 = p3 - ev.clientX; p2 = p4 - ev.clientY; p3 = ev.clientX; p4 = ev.clientY;
                el.style.top = (el.offsetTop - p2) + "px"; el.style.left = (el.offsetLeft - p1) + "px";
                el.style.bottom = "auto"; el.style.right = "auto";
            };
            document.onmouseup = () => { document.onmousemove = null; };
        };
    }

    initLibrary();
    makePanelDraggable(document.querySelector('.toolbar'));
    makePanelDraggable(document.querySelector('.symbol-library'));
    makePanelDraggable(document.querySelector('.style-bar'));
</script>
</body>
</html>
